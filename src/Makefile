#
# This file is generated by Ray 2009.1.6
#

CC	= g++ 
RANLIB = ranlib
INCDIR = -I../include/athena -I/usr/include/libxml2
INCDIR_PROC = INCLUDE=../include
LIBDIR = 
LIBS = -lrt -lpthread -lxml2 
#注：Solaris下面需要修改为以下语句
#LIBS = -lrt -lpthread -lsocket
#CFLAGS = -O2 -Wall
CFLAGS = -Wall
DFLAGS = -fpic -fPIC -shared
DEFINE = -D_REENTRANT -DHAVE_PTHREAD_H -D_LINUX_ -D_GNU_SOURCE #-D_SUNOS_

# Following is for posix ipc
POSIX = -DHAVE_MQUEUE_H -DHAVE_SEMAPHORE_H -DHAVE_SYS_MMAN_H 

# Following is for system v ipc
SYSTEMV = -DHAVE_SYS_MSG_H -DHAVE_SYS_SEM_H -DHAVE_SYS_SHM_H 

# 修改为POSIX或System V编译
DEFINE += $(POSIX)
#DEFINE += $(SYSTEMV)

#是否Debug
#DEBUG = -g -D_DEBUG
DEFINE += $(DEBUG)

############################################
STATIC_LIB =  ../lib/libutility.a
DYNAMIC_LIB = ../lib/libutility.so
LIB_OBJS = RCondition.o RNetAddress.o RShareMem.o RStream.o RTime.o \
RMsgQueue.o RNetUnidef.o RSMutex.o RTcpSocket.o RUdpSocket.o RRawSocket.o \
RMutex.o RSemaphore.o RSocket.o RString.o RThread.o RException.o RRecord.o RLog.o \
RTools.o RTxtParser.o RXml.o RFileLock.o RBasicApp.o RProcess.o RLogThread.o \
sha1.o 3des.o Msg.o Sem.o Shm.o

all : static dynamic 

static: $(STATIC_LIB)

dynamic: $(DYNAMIC_LIB)

$(STATIC_LIB): $(LIB_OBJS)
	ar rv ${STATIC_LIB} $(LIB_OBJS)
	${RANLIB} ${STATIC_LIB}

$(DYNAMIC_LIB): $(LIB_OBJS)
	$(CC) -shared $(LIBDIR) $(LIBS) -o $@ $(LIB_OBJS)

%.o : %.cpp
	$(CC)  $(CFLAGS) $(DFLAGS) $(DEFINE) $(INCDIR) -c $<

%.o : %.c
	gcc $(CFLAGS) $(DEFINE) $(INCDIR) -c $<

%.cpp:%.pc
	proc $(INCDIR_PROC) line=yes parse=none code=cpp iname=$< oname=$*.cpp

clean:cleanlibs

cleanlibs:
	rm -f $(STATIC_LIB) $(DYNAMIC_LIB) ${CLEANFILES} tp* *.lis

CLEANFILES = core core.* *.core *.o temp.* *.out typescript* \
                *.[234]c *.[234]h *.bsdi *.sparc *.uw
